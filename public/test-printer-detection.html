<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Detecci√≥n de Impresoras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .container { max-width: 800px; margin-top: 50px; }
        .printer-item { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .recommended { border-color: #28a745; background-color: #f8fff9; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">üñ®Ô∏è Test de Detecci√≥n de Impresoras</h1>

        <div class="card">
            <div class="card-header">
                <h5>Informaci√≥n del Sistema</h5>
            </div>
            <div class="card-body">
                <div id="system-info">
                    <p><strong>Navegador:</strong> <span id="browser-info"></span></p>
                    <p><strong>Plataforma:</strong> <span id="platform-info"></span></p>
                    <p><strong>Idioma:</strong> <span id="language-info"></span></p>
                    <p><strong>En l√≠nea:</strong> <span id="online-info"></span></p>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5>Selector de Impresoras</h5>
            </div>
            <div class="card-body">
                <!-- El detector de impresoras se cargar√° aqu√≠ -->
                <div id="printer-selector-container"></div>
                <div id="printer-info-display"></div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5>M√©todos de Detecci√≥n</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <button class="btn btn-primary w-100 mb-2" onclick="checkPrintSupport()">
                            Verificar Soporte de Impresi√≥n
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-info w-100 mb-2" onclick="checkMediaQueries()">
                            Verificar Media Queries
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-success w-100 mb-2" onclick="showPrintDialog()">
                            Mostrar Di√°logo de Impresi√≥n
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-warning w-100 mb-2" onclick="detectByUserAgent()">
                            Detectar por User Agent
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5>Resultados de Detecci√≥n</h5>
            </div>
            <div class="card-body">
                <div id="detection-results">
                    <p class="text-muted">Haz clic en los botones de arriba para ver los resultados</p>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5>Consejos para Impresoras de 80mm</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6>Para obtener mejores resultados:</h6>
                    <ul>
                        <li><strong>Configura tu impresora t√©rmica como predeterminada</strong> en el sistema operativo</li>
                        <li><strong>Establece el tama√±o de papel a 80mm</strong> en las propiedades de la impresora</li>
                        <li><strong>Desactiva los m√°rgenes</strong> para aprovechar todo el ancho del papel</li>
                        <li><strong>Usa driver espec√≠fico</strong> del fabricante si est√° disponible</li>
                        <li><strong>Prueba la impresi√≥n</strong> antes de imprimir tickets importantes</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Cargar nuestro detector de impresoras -->
    <script src="assets/js/printer-detection.js"></script>

    <script>
        // Mostrar informaci√≥n del sistema
        document.getElementById('browser-info').textContent = navigator.userAgent;
        document.getElementById('platform-info').textContent = navigator.platform;
        document.getElementById('language-info').textContent = navigator.language;
        document.getElementById('online-info').textContent = navigator.onLine ? 'S√≠' : 'No';

        // Funci√≥n para verificar soporte de impresi√≥n
        function checkPrintSupport() {
            const results = [];

            // Verificar si window.print est√° disponible
            results.push(`window.print: ${typeof window.print === 'function' ? '‚úÖ Disponible' : '‚ùå No disponible'}`);

            // Verificar media queries de impresi√≥n
            const printMedia = window.matchMedia('print');
            results.push(`Media Query 'print': ${printMedia ? '‚úÖ Soportado' : '‚ùå No soportado'}`);

            // Verificar APIs espec√≠ficas
            results.push(`getUserMedia: ${navigator.getUserMedia ? '‚úÖ Disponible' : '‚ùå No disponible'}`);
            results.push(`Permissions API: ${navigator.permissions ? '‚úÖ Disponible' : '‚ùå No disponible'}`);

            showResults('Soporte de Impresi√≥n', results);
        }

        // Funci√≥n para verificar media queries
        function checkMediaQueries() {
            const queries = [
                'print',
                'print and (monochrome)',
                'print and (color)',
                'print and (min-width: 80mm)',
                'print and (max-width: 80mm)'
            ];

            const results = queries.map(query => {
                const media = window.matchMedia(query);
                return `${query}: ${media.matches ? '‚úÖ Coincide' : '‚ùå No coincide'}`;
            });

            showResults('Media Queries de Impresi√≥n', results);
        }

        // Funci√≥n para mostrar di√°logo de impresi√≥n
        function showPrintDialog() {
            const beforePrint = () => {
                console.log('Preparando impresi√≥n...');
                showResults('Evento de Impresi√≥n', ['‚úÖ beforeprint disparado']);
            };

            const afterPrint = () => {
                console.log('Impresi√≥n completada o cancelada');
                showResults('Evento de Impresi√≥n', ['‚úÖ afterprint disparado']);
            };

            window.addEventListener('beforeprint', beforePrint);
            window.addEventListener('afterprint', afterPrint);

            // Simular impresi√≥n
            window.print();

            // Limpiar eventos despu√©s de un tiempo
            setTimeout(() => {
                window.removeEventListener('beforeprint', beforePrint);
                window.removeEventListener('afterprint', afterPrint);
            }, 5000);
        }

        // Funci√≥n para detectar por User Agent
        function detectByUserAgent() {
            const ua = navigator.userAgent;
            const results = [];

            // Detectar sistema operativo
            if (ua.includes('Windows')) {
                results.push('üñ•Ô∏è Sistema: Windows');
                results.push('üìù Recomendaci√≥n: Usar Panel de Control > Dispositivos e Impresoras');
            } else if (ua.includes('Mac')) {
                results.push('üçé Sistema: macOS');
                results.push('üìù Recomendaci√≥n: Usar Preferencias del Sistema > Impresoras');
            } else if (ua.includes('Linux')) {
                results.push('üêß Sistema: Linux');
                results.push('üìù Recomendaci√≥n: Usar CUPS o sistema de impresi√≥n');
            } else {
                results.push('‚ùì Sistema: Desconocido');
            }

            // Detectar navegador
            if (ua.includes('Chrome')) {
                results.push('üåê Navegador: Chrome - Buen soporte para impresi√≥n');
            } else if (ua.includes('Firefox')) {
                results.push('ü¶ä Navegador: Firefox - Soporte est√°ndar para impresi√≥n');
            } else if (ua.includes('Safari')) {
                results.push('üß≠ Navegador: Safari - Soporte b√°sico para impresi√≥n');
            } else if (ua.includes('Edge')) {
                results.push('üî∑ Navegador: Edge - Buen soporte para impresi√≥n');
            }

            // Detectar dispositivo m√≥vil
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            if (isMobile) {
                results.push('üì± Dispositivo: M√≥vil - Usar funci√≥n de compartir para imprimir');
            } else {
                results.push('üñ•Ô∏è Dispositivo: Escritorio - Soporte completo para impresi√≥n');
            }

            showResults('Detecci√≥n por User Agent', results);
        }

        // Funci√≥n para mostrar resultados
        function showResults(title, results) {
            const container = document.getElementById('detection-results');
            const html = `
                <div class="alert alert-light">
                    <h6>${title}</h6>
                    <ul class="mb-0">
                        ${results.map(result => `<li>${result}</li>`).join('')}
                    </ul>
                </div>
            `;
            container.innerHTML = html;
        }

        // Funci√≥n para obtener informaci√≥n de impresoras actualmente seleccionada
        function showCurrentPrinterInfo() {
            if (typeof printerDetector !== 'undefined') {
                const selected = printerDetector.getSelectedPrinter();
                const all = printerDetector.getAllPrinters();

                console.log('Impresora seleccionada:', selected);
                console.log('Todas las impresoras:', all);

                Swal.fire({
                    title: 'Informaci√≥n de Impresoras',
                    html: `
                        <p><strong>Seleccionada:</strong> ${selected ? selected.name : 'Ninguna'}</p>
                        <p><strong>Total detectadas:</strong> ${all.length}</p>
                        <p><strong>Detalles:</strong></p>
                        <pre>${JSON.stringify({selected, all}, null, 2)}</pre>
                    `,
                    icon: 'info'
                });
            } else {
                Swal.fire('Error', 'Detector de impresoras no est√° cargado', 'error');
            }
        }

        // Agregar bot√≥n para mostrar informaci√≥n actual
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.querySelector('.card-body');
            if (container) {
                const button = document.createElement('button');
                button.className = 'btn btn-outline-secondary mt-2';
                button.textContent = 'Ver Informaci√≥n Actual de Impresoras';
                button.onclick = showCurrentPrinterInfo;
                container.appendChild(button);
            }
        });
    </script>
</body>
</html>
